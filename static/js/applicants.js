!function(n){function e(e){for(var a,s,i=e[0],c=e[1],l=e[2],_=0,d=[];_<i.length;_++)s=i[_],Object.prototype.hasOwnProperty.call(r,s)&&r[s]&&d.push(r[s][0]),r[s]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(n[a]=c[a]);for(p&&p(e);d.length;)d.shift()();return o.push.apply(o,l||[]),t()}function t(){for(var n,e=0;e<o.length;e++){for(var t=o[e],a=!0,i=1;i<t.length;i++){var c=t[i];0!==r[c]&&(a=!1)}a&&(o.splice(e--,1),n=s(s.s=t[0]))}return n}var a={},r={applicants:0},o=[];function s(e){if(a[e])return a[e].exports;var t=a[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,s),t.l=!0,t.exports}s.m=n,s.c=a,s.d=function(n,e,t){s.o(n,e)||Object.defineProperty(n,e,{enumerable:!0,get:t})},s.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},s.t=function(n,e){if(1&e&&(n=s(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var t=Object.create(null);if(s.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var a in n)s.d(t,a,function(e){return n[e]}.bind(null,a));return t},s.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return s.d(e,"a",e),e},s.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},s.p="/static/js/";var i=window.webpackJsonp=window.webpackJsonp||[],c=i.push.bind(i);i.push=e,i=i.slice();for(var l=0;l<i.length;l++)e(i[l]);var p=c;o.push(["./src/applicants.ts","vendors_applicants_carriers_icoBuy_icoVoting_main_voting","vendors_applicants_carriers_icoBuy_icoVoting_voting","vendors_applicants_icoVoting","vendors_applicants","applicants_carriers_icoBuy_icoVoting_voting"]),t()}({"./node_modules/moment/locale sync recursive (en|pl|cs)$":
/*!*****************************************************!*\
  !*** ./node_modules/moment/locale sync (en|pl|cs)$ ***!
  \*****************************************************/
/*! no static exports found */function(module,exports,__webpack_require__){eval('var map = {\n\t"./cs": "./node_modules/moment/locale/cs.js",\n\t"./pl": "./node_modules/moment/locale/pl.js"\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error("Cannot find module \'" + req + "\'");\n\t\te.code = \'MODULE_NOT_FOUND\';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = "./node_modules/moment/locale sync recursive (en|pl|cs)$";\n\n//# sourceURL=webpack:///./node_modules/moment/locale_sync_(en%7Cpl%7Ccs)$?')},"./src/applicants.ts":
/*!***************************!*\
  !*** ./src/applicants.ts ***!
  \***************************/
/*! no exports provided */function(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var vue__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! vue */ "./node_modules/vue/dist/vue.esm.js");\n/* harmony import */ var moment__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! moment */ "./node_modules/moment/moment.js");\n/* harmony import */ var moment__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(moment__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _components_blockchain__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./components/blockchain */ "./src/components/blockchain.ts");\n\n\n\nvar VTooltip = __webpack_require__(/*! v-tooltip */ "./node_modules/v-tooltip/dist/v-tooltip.esm.js");\nvar firstLoadCount = 3;\nvar sharedData = {\n    applicants: [],\n    enabledMetamask: false,\n    loading: false,\n    votersCount: 0,\n    showModal: false,\n    selectedApplicant: -1,\n    applicantsCount: 0,\n    metamaskState: { enabledMetamask: false, userAddress: "" },\n};\nvar Applicants = /** @class */ (function () {\n    function Applicants() {\n        var _this = this;\n        this.blockchain = new _components_blockchain__WEBPACK_IMPORTED_MODULE_2__["default"](false);\n        this.blockchain.loadContract("VotingCarrier", function (contract) {\n            contract.events.allEvents({}, function (error, event) {\n                if (typeof event.returnValues != "undefined")\n                    _this.resolveEvent(event);\n            });\n            _this.loadApplicantsCount();\n        });\n        moment__WEBPACK_IMPORTED_MODULE_1___default.a.locale(\'pl\');\n        this.initVue();\n    }\n    Applicants.prototype.initVue = function () {\n        var _this = this;\n        vue__WEBPACK_IMPORTED_MODULE_0__["default"].use(VTooltip);\n        vue__WEBPACK_IMPORTED_MODULE_0__["default"].component(\'modal\', {\n            template: \'#modal-template\'\n        });\n        this.vue = new vue__WEBPACK_IMPORTED_MODULE_0__["default"]({\n            el: "#applicants",\n            template: "#applicants-template",\n            delimiters: [\'${\', \'}\'],\n            data: sharedData,\n            created: function () {\n                var _this = this;\n                setInterval(function () {\n                    _this.$forceUpdate();\n                }, 30 * 1000);\n            },\n            watch: {},\n            methods: {\n                isVoted: function (applicant) {\n                    var _this = this;\n                    return applicant.voters.findIndex(function (el) { return el.toUpperCase() == _this.metamaskState.userAddress.toUpperCase(); });\n                },\n                toEndText: function (time) {\n                    return moment__WEBPACK_IMPORTED_MODULE_1___default()(time * 1000).fromNow();\n                },\n                ended: function (time) {\n                    return moment__WEBPACK_IMPORTED_MODULE_1___default()().isBefore(moment__WEBPACK_IMPORTED_MODULE_1___default()(time * 1000));\n                },\n                avatarChars: function (name) {\n                    return name[0] + name[name.length - 1];\n                },\n                finish: function (index) { _this.finish(index); },\n                vote: function (index, vote) { _this.vote(index, vote); },\n                detail: function (index) {\n                    this.selectedApplicant = index;\n                    this.showModal = true;\n                },\n                loadNext: function () {\n                    _this.loadAplicants(sharedData.applicantsCount - sharedData.applicants.length - 1, firstLoadCount, false);\n                }\n            }\n        });\n    };\n    Applicants.prototype.getIndexById = function (id) {\n        return sharedData.applicants.findIndex(function (el) { return el.index === id; });\n    };\n    Applicants.prototype.resolveEvent = function (e) {\n        console.log(e);\n        var index;\n        switch (e.event) {\n            case "VoteCarrier":\n                index = this.getIndexById(e.returnValues.proposalIndex);\n                if (index != -1) {\n                    sharedData.applicants[index].voted += 1;\n                    sharedData.applicants[index].voters.push(e.returnValues.addr);\n                    sharedData.applicants[index].votersVotes.push(e.returnValues.vote);\n                    if (e.returnValues.vote < 2) {\n                        sharedData.applicants[index][e.returnValues.vote == 1 ? "yes" : "no"] += 1;\n                    }\n                }\n                break;\n            case "FinishVotingCarrier":\n                index = this.getIndexById(e.returnValues.proposalIndex);\n                if (index != -1) {\n                    sharedData.applicants[index].result = e.returnValues.result ? 1 : 0;\n                }\n                break;\n            case "CarrierProposalCreated":\n                this.loadAplicants(e.returnValues.proposalIndex, 1, true);\n                break;\n        }\n    };\n    Applicants.prototype.finish = function (index) {\n        var _this = this;\n        var id = this.getIndexById(index);\n        sharedData.applicants[id].tx = "";\n        this.blockchain.callContract("VotingCarrier", "beforeFinishCarrierProposal", function (error) {\n            if (error[0]) {\n                $.jGrowl(error[1], { header: "error", life: 10000 });\n            }\n            else {\n                _this.blockchain.sendContract("VotingCarrier", "finishCarrierProposal", { "from": sharedData.metamaskState.userAddress }, function (success) {\n                    if (id != -1) {\n                        sharedData.applicants[id].tx = success;\n                    }\n                }, null, _this.blockchain.numberToHex(index));\n            }\n        }, null, this.blockchain.numberToHex(index));\n    };\n    Applicants.prototype.vote = function (vote, index) {\n        var _this = this;\n        var id = this.getIndexById(index);\n        sharedData.applicants[id].tx = "";\n        this.blockchain.callContract("VotingCarrier", "beforeVoteInCarrierProposal", function (error) {\n            if (error[0]) {\n                $.jGrowl(error[1], { header: "error", life: 10000 });\n            }\n            else {\n                _this.blockchain.sendContract("VotingCarrier", "voteInCarrierProposal", { "from": sharedData.metamaskState.userAddress }, function (success) {\n                    if (id != -1) {\n                        sharedData.applicants[id].tx = success;\n                    }\n                }, null, _this.blockchain.numberToHex(index), _this.blockchain.numberToHex(vote));\n            }\n        }, null, index, sharedData.metamaskState.userAddress);\n    };\n    Applicants.prototype.loadApplicantsCount = function () {\n        var _this = this;\n        this.blockchain.callContract("VotingCarrier", "proposalsLength", function (response) {\n            sharedData.applicantsCount = response;\n            if (response == 0)\n                sharedData.loading = false;\n            _this.loadAplicants(response - 1, firstLoadCount, false);\n        });\n        this.blockchain.callContract("VotingCarrier", "VotersLength", function (response) {\n            sharedData.votersCount = response;\n        });\n    };\n    Applicants.prototype.loadAplicants = function (index, max, toUp) {\n        var _this = this;\n        if (index < 0 || max <= 0) {\n            sharedData.loading = false;\n            return;\n        }\n        sharedData.loading = true;\n        this.blockchain.callContract("VotingCarrier", "carrierProposals", function (response) {\n            _this.blockchain.callContract("VotingCarrier", "statusOfCarrierProposal", function (responseStatus) {\n                var yes = 0, no = 0, voted = 0;\n                for (var i = 0; i < responseStatus[0].length; i++) {\n                    if (responseStatus[0][i] != "0x0000000000000000000000000000000000000000") {\n                        voted++;\n                        if (responseStatus[1][i] == 0)\n                            no++;\n                        else if (responseStatus[1][i] == 1)\n                            yes++;\n                    }\n                }\n                var data = {\n                    actionAddress: response.actionAddress,\n                    actionType: response.actionType,\n                    endTime: response.endTime,\n                    name: _this.blockchain.fromHex(response.name),\n                    web: _this.blockchain.fromHex(response.web),\n                    index: index,\n                    voters: responseStatus[0],\n                    votersVotes: responseStatus[1],\n                    voted: voted,\n                    yes: yes,\n                    no: no,\n                    result: response.result,\n                    tx: "",\n                    showVoteButtons: false,\n                };\n                if (toUp)\n                    sharedData.applicants.unshift(data);\n                else\n                    sharedData.applicants.push(data);\n            }, null, index);\n            _this.loadAplicants(index - 1, max - 1, toUp);\n        }, null, index);\n    };\n    return Applicants;\n}());\n$(document).ready(function () {\n    new Applicants();\n});\n\n\n//# sourceURL=webpack:///./src/applicants.ts?')}});