(window.webpackJsonp=window.webpackJsonp||[]).push([["applicants_carriers_icoBuy_icoVoting_voting"],{"./src/components/blockchain.ts":
/*!**************************************!*\
  !*** ./src/components/blockchain.ts ***!
  \**************************************/
/*! exports provided: default */function(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var vue__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! vue */ "./node_modules/vue/dist/vue.esm.js");\n/* harmony import */ var web3__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! web3 */ "./node_modules/web3/src/index.js");\n/* harmony import */ var web3__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(web3__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var vue_popperjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! vue-popperjs */ "./node_modules/vue-popperjs/dist/vue-popper.min.js");\n/* harmony import */ var vue_popperjs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(vue_popperjs__WEBPACK_IMPORTED_MODULE_2__);\nvar __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (undefined && undefined.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError("Generator is already executing.");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\n\n\n// @ts-ignore\n\nvar addresses = {\n    wssUrl: "wss://kovan.infura.io/ws/v3/eabd1b929937436ea9a0529c3eae21c8",\n    FloteaToken: "0x1C94D0D2F4ED3E8Cd38B0cBA9C8d05e6648fdaa2",\n    VotingCarrier: "0xa71eE8c6fb6079FCB8b13Fa81Bb554950809A74C",\n    Carriers: "0xC9C5c6Ac5836AaCEA50Fe7fcf286071032cE5451",\n    FloteaICO: "0xDa8370898A95446875DaC7AeAd92E5fd5851174D",\n    Transport: "0x0D2C2582F68f792E4f7c6b8045D5a9Ae70806526",\n};\nvar blockchainSharedData = {\n    enabledMetamask: false,\n    userAddress: null,\n    carrierName: "",\n    carrierWeb: "",\n    userType: 0,\n    flt: 0,\n    eth: 0,\n    isMetamask: true,\n    contractsLoaded: false,\n    waitForResponse: false,\n};\nvar Blockchain = /** @class */ (function () {\n    function Blockchain(onlyRead) {\n        this.contracts = [];\n        this.contractsCall = [];\n        this.initializedEvents = false;\n        this.onlyRead = false;\n        this.onlyRead = onlyRead;\n        if (this.onlyRead) {\n            this.initWebsocketProvider();\n        }\n        this.register();\n    }\n    Blockchain.prototype.register = function () {\n        var bl = this;\n        vue__WEBPACK_IMPORTED_MODULE_0__["default"].component(\'MetamaskButton\', {\n            components: {\n                \'popper\': vue_popperjs__WEBPACK_IMPORTED_MODULE_2___default.a\n            },\n            mounted: function () {\n                bl.initWebsocketProvider();\n                bl.mainInit();\n                this.$emit(\'getObject\', bl);\n            },\n            data: function () {\n                return blockchainSharedData;\n            },\n            computed: {\n                metamaskState: function () {\n                    return {\n                        enabledMetamask: blockchainSharedData.enabledMetamask,\n                        userAddress: blockchainSharedData.userAddress,\n                        carrierName: blockchainSharedData.carrierName,\n                        carrierWeb: blockchainSharedData.carrierWeb,\n                        userType: blockchainSharedData.userType,\n                        flt: blockchainSharedData.flt,\n                        eth: blockchainSharedData.eth,\n                        isMetamask: blockchainSharedData.isMetamask,\n                    };\n                }\n            },\n            watch: {\n                metamaskState: function (newState) {\n                    this.$emit(\'metamaskUpdated\', newState);\n                }\n            },\n            template: \'<popper> <div class="popper"> <h3 v-if="carrierName!=\\\'\\\'">{{carrierName}}</h3> <div>{{eth.toFixed(4)}} ETH </div> <div> {{flt.toFixed(2)}} FLT </div> {{userAddress}} </div> <div slot="reference" class="metamask" @click="enableMetamask"> <img v-if="!enabledMetamask" src="/static/img/metamask-logo-92-a-73-d-44-kopia@3x.png" /> <img src="/static/img/user-solid.svg" class="user-icon" v-if="enabledMetamask" /> <span>{{enabledMetamask? "Połączony":"Odblokuj Metamask"}}</span> <span v-if="enabledMetamask">{{userType==0? "pasażer": "przewoźnik"}}</span> </div> </popper>\',\n            methods: {\n                enableMetamask: function () {\n                    if (!this.isMetamask) {\n                        var link = "https://metamask.io/";\n                        if (navigator.userAgent.indexOf("Opera") != -1 || navigator.userAgent.indexOf(\'OPR\') != -1)\n                            link = "https://addons.opera.com/en/extensions/details/metamask/";\n                        else if (navigator.userAgent.indexOf("Chrome") != -1) // Chrome and Brave have same addon\n                            link = "https://chrome.google.com/webstore/detail/nkbihfbeogaeaoehlefnkodbefgpgknn";\n                        else if (navigator.userAgent.indexOf("Firefox") != -1)\n                            link = "https://addons.mozilla.org/en-US/firefox/addon/ether-metamask/";\n                        window.open(link, \'_blank\');\n                    }\n                    else if (!this.enabledMetamask) {\n                        bl.init();\n                    }\n                }\n            },\n        });\n    };\n    Blockchain.prototype.mainInit = function () {\n        var _this = this;\n        this.getAccounts();\n        this.init();\n        this.loadContract("FloteaToken", function () { return _this.loadContract("Carriers", function () {\n            blockchainSharedData.contractsLoaded = true;\n            if (blockchainSharedData.enabledMetamask) {\n                _this.getAccountInfo();\n            }\n        }); });\n    };\n    Blockchain.prototype.init = function () {\n        var _this = this;\n        if (blockchainSharedData.waitForResponse)\n            return;\n        if (window.ethereum) {\n            blockchainSharedData.waitForResponse = true;\n            window.ethereum.autoRefreshOnNetworkChange = false;\n            window.web3 = new web3__WEBPACK_IMPORTED_MODULE_1___default.a(window.ethereum);\n            var main = function () { return __awaiter(_this, void 0, void 0, function () {\n                return __generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0: return [4 /*yield*/, window.ethereum.enable()];\n                        case 1:\n                            _a.sent();\n                            return [2 /*return*/];\n                    }\n                });\n            }); };\n            main().catch(function (err) {\n                blockchainSharedData.waitForResponse = false;\n                $.jGrowl("Please enable MetaMask, or Opera Wallet.", { position: "center", header: \'Error\', life: 10000 });\n            });\n        }\n        else {\n            blockchainSharedData.isMetamask = false;\n            $.jGrowl("Non-Ethereum browser detected. You should consider trying MetaMask or Opera browser!", { position: "center", header: \'Error\', life: 10000 });\n        }\n    };\n    Blockchain.prototype.getAccountInfo = function () {\n        var _this = this;\n        this.callContract("Carriers", "getCarrierData", function (response) {\n            if (response.exist) {\n                blockchainSharedData.carrierName = _this.fromHex(response.company);\n                blockchainSharedData.carrierWeb = _this.fromHex(response.web);\n                blockchainSharedData.userType = 1;\n            }\n            else {\n                blockchainSharedData.carrierName = "";\n                blockchainSharedData.carrierWeb = "";\n                blockchainSharedData.userType = 0;\n            }\n        }, null, blockchainSharedData.userAddress);\n        this.callContract("FloteaToken", "balanceOf", function (balance) {\n            blockchainSharedData.flt = balance / 100;\n        }, null, blockchainSharedData.userAddress);\n        web3.eth.getBalance(blockchainSharedData.userAddress).then(function (amount) {\n            blockchainSharedData.eth = amount / Math.pow(10, 18);\n        });\n    };\n    Blockchain.prototype.getAccounts = function () {\n        var _this = this;\n        var accountInterval = setInterval(function () {\n            if (web3.currentProvider.selectedAddress !== blockchainSharedData.userAddress) {\n                blockchainSharedData.userAddress = web3.currentProvider.selectedAddress;\n                if (blockchainSharedData.userAddress != null) {\n                    blockchainSharedData.enabledMetamask = true;\n                    if (blockchainSharedData.contractsLoaded) {\n                        _this.getAccountInfo();\n                    }\n                }\n                else {\n                    blockchainSharedData.enabledMetamask = false;\n                }\n            }\n        }, 500);\n    };\n    Blockchain.prototype.initWebsocketProvider = function () {\n        window.web3wss = new web3__WEBPACK_IMPORTED_MODULE_1___default.a(new web3__WEBPACK_IMPORTED_MODULE_1___default.a.providers.WebsocketProvider(addresses.wssUrl));\n    };\n    Blockchain.prototype.callContract = function (contract, method, success, error) {\n        var _a;\n        var _this = this;\n        if (error === void 0) { error = null; }\n        var params = [];\n        for (var _i = 4; _i < arguments.length; _i++) {\n            params[_i - 4] = arguments[_i];\n        }\n        (_a = this.contractsCall[contract].methods)[method].apply(_a, params).call().then(function (result) {\n            if (typeof success == "function")\n                success(result);\n        }).catch(function (err) {\n            console.log(err);\n            if (typeof error == "function")\n                error(err);\n            _this.handleErrorMessages(err);\n        });\n    };\n    Blockchain.prototype.sendContract = function (contract, method, sendParams, success, error) {\n        var _a;\n        var _this = this;\n        if (error === void 0) { error = null; }\n        var params = [];\n        for (var _i = 5; _i < arguments.length; _i++) {\n            params[_i - 5] = arguments[_i];\n        }\n        (_a = this.contracts[contract].methods)[method].apply(_a, params).send(sendParams)\n            .on(\'transactionHash\', function (hash) {\n            if (typeof success == "function")\n                success(hash);\n            console.log(hash);\n        })\n            .on(\'receipt\', function (receipt) {\n            console.log(receipt);\n        })\n            .on(\'error\', function (err) {\n            if (typeof error == "function")\n                error(err);\n            _this.handleErrorMessages(err);\n        });\n    };\n    Blockchain.prototype.sendTransaction = function (to, value, gas, success, error) {\n        var _this = this;\n        if (error === void 0) { error = null; }\n        web3.eth.sendTransaction({\n            from: blockchainSharedData.userAddress,\n            to: to,\n            gas: gas,\n            value: value\n        }).on(\'transactionHash\', function (hash) {\n            if (typeof success == "function")\n                success(hash);\n            console.log(hash);\n        })\n            .on(\'receipt\', function (receipt) {\n            console.log(receipt);\n        })\n            .on(\'error\', function (err) {\n            if (typeof error == "function")\n                error(err);\n            _this.handleErrorMessages(err);\n        });\n    };\n    Blockchain.prototype.loadContract = function (name, fn) {\n        var _this = this;\n        if (fn === void 0) { fn = null; }\n        if (typeof this.contracts[name] != "undefined") {\n            if (typeof fn == "function")\n                fn(this.contracts[name]);\n            return;\n        }\n        $.getJSON("/static/" + name + ".json", function (e) {\n            if (typeof window.web3 == "object" && !_this.onlyRead)\n                _this.contracts[name] = new window.web3.eth.Contract(e.abi, addresses[name]);\n            _this.contractsCall[name] = new window.web3wss.eth.Contract(e.abi, addresses[name]);\n            if (typeof fn == "function") {\n                fn(_this.contractsCall[name]);\n            }\n        });\n    };\n    Blockchain.prototype.loadContractAtAddress = function (name, address, fn) {\n        var _this = this;\n        if (typeof this.contracts[name + address] != "undefined") {\n            if (typeof fn == "function")\n                fn(this.contracts[name + address]);\n            return;\n        }\n        $.getJSON("/static/" + name + ".json", function (e) {\n            if (typeof window.web3 == "object" && !_this.onlyRead)\n                _this.contracts[name + address] = new window.web3.eth.Contract(e.abi, address);\n            _this.contractsCall[name + address] = new window.web3wss.eth.Contract(e.abi, address);\n            if (typeof fn == "function") {\n                fn(_this.contractsCall[name + address]);\n            }\n        });\n    };\n    Blockchain.prototype.fromHex = function (hex) {\n        return window.web3wss.utils.hexToUtf8(hex);\n    };\n    Blockchain.prototype.toHex = function (str) {\n        var hex = window.web3wss.utils.utf8ToHex(str.toString());\n        return hex + \'0\'.repeat(66 - hex.length);\n    };\n    Blockchain.prototype.numberToHex = function (number) {\n        return window.web3wss.utils.numberToHex(number);\n    };\n    Blockchain.prototype.hexToNumber = function (number) {\n        return window.web3wss.utils.hexToNumber(number);\n    };\n    Blockchain.prototype.handleErrorMessages = function (error) {\n        $.jGrowl(error.stack, { position: "center", header: error.message, life: 10000 });\n    };\n    return Blockchain;\n}());\n/* harmony default export */ __webpack_exports__["default"] = (Blockchain);\n\n\n//# sourceURL=webpack:///./src/components/blockchain.ts?')},0:
/*!************************!*\
  !*** buffer (ignored) ***!
  \************************/
/*! no static exports found */function(module,exports){eval("/* (ignored) */\n\n//# sourceURL=webpack:///buffer_(ignored)?")},1:
/*!**********************!*\
  !*** util (ignored) ***!
  \**********************/
/*! no static exports found */function(module,exports){eval("/* (ignored) */\n\n//# sourceURL=webpack:///util_(ignored)?")},2:
/*!**********************!*\
  !*** util (ignored) ***!
  \**********************/
/*! no static exports found */function(module,exports){eval("/* (ignored) */\n\n//# sourceURL=webpack:///util_(ignored)?")},3:
/*!************************!*\
  !*** crypto (ignored) ***!
  \************************/
/*! no static exports found */function(module,exports){eval("/* (ignored) */\n\n//# sourceURL=webpack:///crypto_(ignored)?")}}]);