!function(n){function e(e){for(var o,a,i=e[0],l=e[1],c=e[2],p=0,d=[];p<i.length;p++)a=i[p],Object.prototype.hasOwnProperty.call(r,a)&&r[a]&&d.push(r[a][0]),r[a]=0;for(o in l)Object.prototype.hasOwnProperty.call(l,o)&&(n[o]=l[o]);for(u&&u(e);d.length;)d.shift()();return s.push.apply(s,c||[]),t()}function t(){for(var n,e=0;e<s.length;e++){for(var t=s[e],o=!0,i=1;i<t.length;i++){var l=t[i];0!==r[l]&&(o=!1)}o&&(s.splice(e--,1),n=a(a.s=t[0]))}return n}var o={},r={icoVoting:0},s=[];function a(e){if(o[e])return o[e].exports;var t=o[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,a),t.l=!0,t.exports}a.m=n,a.c=o,a.d=function(n,e,t){a.o(n,e)||Object.defineProperty(n,e,{enumerable:!0,get:t})},a.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},a.t=function(n,e){if(1&e&&(n=a(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var t=Object.create(null);if(a.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var o in n)a.d(t,o,function(e){return n[e]}.bind(null,o));return t},a.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return a.d(e,"a",e),e},a.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},a.p="/static/js/";var i=window.webpackJsonp=window.webpackJsonp||[],l=i.push.bind(i);i.push=e,i=i.slice();for(var c=0;c<i.length;c++)e(i[c]);var u=l;s.push(["./src/icoVoting.ts","vendors_applicants_carriers_icoBuy_icoVoting_main_voting","vendors_applicants_carriers_icoBuy_icoVoting_voting","vendors_applicants_icoVoting","applicants_carriers_icoBuy_icoVoting_voting"]),t()}({"./node_modules/moment/locale sync recursive (en|pl|cs)$":
/*!*****************************************************!*\
  !*** ./node_modules/moment/locale sync (en|pl|cs)$ ***!
  \*****************************************************/
/*! no static exports found */function(module,exports,__webpack_require__){eval('var map = {\n\t"./cs": "./node_modules/moment/locale/cs.js",\n\t"./pl": "./node_modules/moment/locale/pl.js"\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error("Cannot find module \'" + req + "\'");\n\t\te.code = \'MODULE_NOT_FOUND\';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = "./node_modules/moment/locale sync recursive (en|pl|cs)$";\n\n//# sourceURL=webpack:///./node_modules/moment/locale_sync_(en%7Cpl%7Ccs)$?')},"./src/icoVoting.ts":
/*!**************************!*\
  !*** ./src/icoVoting.ts ***!
  \**************************/
/*! no exports provided */function(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var vue__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! vue */ "./node_modules/vue/dist/vue.esm.js");\n/* harmony import */ var moment__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! moment */ "./node_modules/moment/moment.js");\n/* harmony import */ var moment__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(moment__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _components_blockchain__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./components/blockchain */ "./src/components/blockchain.ts");\n\n\n\nvar sharedData = {\n    proposalsLength: 0,\n    proposalShowing: false,\n    selectedProposal: {\n        description: "",\n        endTime: 0,\n        amount: 0,\n        actionAddress: "",\n        actionType: 0,\n        result: 2,\n        name: "",\n        index: 0\n    },\n    selectedStatus: [],\n    userAddress: "",\n    actionType: 0,\n    description: "",\n    durationHours: 2,\n    address: "",\n    name: "",\n    amount: 0,\n    showModal: false,\n    proposals: [],\n    metamaskState: { enabledMetamask: false, userAddress: "" },\n};\nvar Voting = /** @class */ (function () {\n    function Voting() {\n        var _this = this;\n        this.blockchain = new _components_blockchain__WEBPACK_IMPORTED_MODULE_2__["default"](false);\n        this.initVue();\n        this.blockchain.loadContract("FloteaICO", function (c) { return _this.registerEvents(c); });\n    }\n    Voting.prototype.initVue = function () {\n        var voting = this;\n        this.vue = new vue__WEBPACK_IMPORTED_MODULE_0__["default"]({\n            el: "#voting",\n            template: "#app-template",\n            delimiters: [\'${\', \'}\'],\n            data: sharedData,\n            watch: {\n                actionType: function () {\n                    switch (this.actionType) {\n                        case 0:\n                            this.amount = 0;\n                            break;\n                        case 1:\n                            this.name = "";\n                            this.amount = 0;\n                            break;\n                        case 2:\n                            this.name = "";\n                            break;\n                    }\n                }\n            },\n            methods: {\n                loadProposals: this.loadProposals.bind(this),\n                showProposal: function (proposal) {\n                    this.selectedProposal = proposal;\n                    this.proposalShowing = true;\n                    voting.loadProposalStatus(this.selectedProposal.index);\n                },\n                createProposal: function () {\n                    var _this = this;\n                    voting.blockchain.sendContract("FloteaICO", "createProposal", { "from": this.metamaskState.userAddress }, function (err) { return _this.resolveError(err.message); }, voting.blockchain.toHex(this.description), this.durationHours, this.actionType, this.address, voting.blockchain.toHex(this.name), this.amount);\n                },\n                vote: function (type) {\n                    var _this = this;\n                    voting.blockchain.sendContract("FloteaICO", "voteInProposal", { "from": this.userAddress }, function (err) { return _this.resolveError(err.message); }, this.selectedProposal.index, type);\n                },\n                finish: function () {\n                    var _this = this;\n                    voting.blockchain.sendContract("FloteaICO", "finishProposal", { "from": this.userAddress }, function (err) { return _this.resolveError(err.message); }, this.selectedProposal.index);\n                },\n                resolveError: function (str) {\n                    var re1 = /revert (.*)"/;\n                    var re2 = /message":"(.*\\.)\\\\n/;\n                    var result = str.match(re1);\n                    if (result && typeof result[1] != "undefined") {\n                        $.jGrowl(result[1], { header: \'Error\', life: 10000 });\n                    }\n                    result = str.match(re2);\n                    if (result && typeof result[1] != "undefined") {\n                        $.jGrowl(result[1], { header: \'Error\', life: 10000 });\n                    }\n                },\n                listStyle: function (i) {\n                    if (i.result == 2 && this.timeout(i.endTime)) {\n                        return "list-group-item-warning";\n                    }\n                    else if (i.result != 2) {\n                        return (i.result == 0 ? "list-group-item-danger" : "list-group-item-success");\n                    }\n                    else\n                        return "";\n                },\n                enableActionButtons: function () {\n                    return this.selectedProposal.result != 2 || this.timeout(this.selectedProposal.endTime);\n                },\n                timeLeft: function (val) {\n                    return moment__WEBPACK_IMPORTED_MODULE_1___default()().to(val * 1000);\n                },\n                timeout: function (item) {\n                    return moment__WEBPACK_IMPORTED_MODULE_1___default()(item * 1000) < moment__WEBPACK_IMPORTED_MODULE_1___default()();\n                },\n            }\n        });\n    };\n    Voting.prototype.registerEvents = function (contract) {\n        var _this = this;\n        this.loadProposals();\n        contract.events.allEvents(null, function (a, b) {\n            console.log(a, b);\n            if (a != false)\n                return;\n            switch (b.event) {\n                case "ProposalCreated":\n                    $.jGrowl("Proposal created", { header: \'Success\', life: 20000 });\n                    sharedData.proposals = [{\n                            description: _this.blockchain.toHex(b.returnValues.description),\n                            endTime: b.returnValues.endTime,\n                            amount: b.returnValues.amount,\n                            actionAddress: b.returnValues.actionAddress,\n                            actionType: b.returnValues.actionType,\n                            result: 2,\n                            name: _this.blockchain.toHex(b.returnValues.description),\n                            index: b.returnValues.proposalIndex\n                        }].concat(sharedData.proposals);\n                    sharedData.description = "";\n                    sharedData.durationHours = 2;\n                    sharedData.amount = 0;\n                    sharedData.address = "";\n                    sharedData.name = "";\n                    sharedData.showModal = false;\n                    break;\n                case "Vote":\n                    $.jGrowl("Somebody " +\n                        (b.returnValues.vote == 0 ? "voted No" : (b.returnValues.vote == 1 ? "voted Yes" : "Resignated")) +\n                        " in proposal: \'" +\n                        _this.blockchain.toHex(b.returnValues.description) +\n                        "\' from address: " +\n                        b.returnValues.addr, { header: \'Success\', life: 20000 });\n                    if (sharedData.selectedProposal.index == b.returnValues.proposalIndex) {\n                        _this.loadProposalStatus(sharedData.selectedProposal.index);\n                    }\n                    break;\n                case "FinishVoting":\n                    var index = b.returnValues.proposalIndex;\n                    var result = b.returnValues.result ? 1 : 0;\n                    $.jGrowl("Voting \'" +\n                        _this.blockchain.toHex(b.returnValues.description) +\n                        "\' finished ", { header: \'Success\', life: 20000 });\n                    if (sharedData.selectedProposal.index == index) {\n                        sharedData.selectedProposal.result = result;\n                    }\n                    for (var i = 0; i < sharedData.proposals.length; i++) {\n                        if (sharedData.proposals[i].index == index) {\n                            sharedData.proposals[i].result = result;\n                        }\n                    }\n                    break;\n            }\n        });\n    };\n    Voting.prototype.loadProposals = function () {\n        var _this = this;\n        var f = function (index, proposalsLength) {\n            _this.blockchain.callContract("FloteaICO", "proposals", function (r) {\n                //console.log(r, index);\n                sharedData.proposals.push({\n                    description: _this.blockchain.toHex(r.description),\n                    endTime: r.endTime,\n                    amount: r.amount,\n                    actionAddress: r.actionAddress,\n                    actionType: r.actionType,\n                    result: r.result,\n                    name: _this.blockchain.toHex(r.name),\n                    index: index\n                });\n                if (index > 0 && index > proposalsLength - 3)\n                    f(index - 1, proposalsLength);\n            }, null, [index]);\n        };\n        if (sharedData.proposals.length == 0) {\n            this.blockchain.callContract("FloteaICO", "proposalsLength", function (r) {\n                sharedData.proposalsLength = r;\n                if (sharedData.proposalsLength > 0) {\n                    f(sharedData.proposalsLength - 1, sharedData.proposalsLength);\n                }\n            }, null);\n        }\n        else {\n            f(sharedData.proposalsLength - sharedData.proposals.length - 1, sharedData.proposalsLength - sharedData.proposals.length);\n        }\n    };\n    Voting.prototype.loadProposalStatus = function (proposalIndex) {\n        var _this = this;\n        this.blockchain.callContract("FloteaICO", "statusOfProposal", function (r) {\n            sharedData.selectedStatus = [];\n            if (typeof r[0] == "object") {\n                var empty = \'0x\' + \'0\'.repeat(40);\n                for (var i = 0; i < r[0].length; i++) {\n                    if (r[0][i] != empty) {\n                        sharedData.selectedStatus.push({\n                            "address": r[0][i],\n                            "name": _this.blockchain.toHex(r[1][i]),\n                            "vote": r[2][i]\n                        });\n                    }\n                }\n            }\n        }, null, proposalIndex);\n    };\n    return Voting;\n}());\n$(document).ready(function () {\n    if ($("#voting").length > 0)\n        new Voting();\n});\n\n\n//# sourceURL=webpack:///./src/icoVoting.ts?')}});